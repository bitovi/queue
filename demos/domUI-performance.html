<style>
    .container {
        border: solid 1px black;
        height: 22px;
    }
    .slider {
        border: solid 1px green;
        width: 20px;
        height: 20px;
        position: absolute;
        background-color: red;
    }
</style>
<p><button id='update-thrash'>Update Thrashing</button></p>
<p><button id='update-queued'>Update Queued</button></p>


<div id='thrashing'></div>
<div id='queued'>Queued</div>
<script src="../../node_modules/steal/steal.js" main="@empty"></script>
<script src="../node_modules/steal/steal.js" main="@empty"></script>
<script type="text/steal-module" id="demo-source">
import queues from "can-queues";

var queuedListeners = [],
    thrashingListeners = []

function thrashingWidget(containerWidth) {
    var container = document.createElement("div");
    container.classList.add("container");
    container.style.width = containerWidth;
    container.innerHTML = `<div class='slider'/>`;

    var slider = container.firstChild;

    thrashingListeners.push(function(newPercent){
        // read value
        var left = newPercent * container.offsetWidth;
        // write value
        slider.style.left = left+"px"
    });

    return container;
}

function queuedWidget(containerWidth) {
    var container = document.createElement("div");
    container.classList.add("container");
    container.style.width = containerWidth;
    container.innerHTML = `<div class='slider'/>`
    var slider = container.firstChild;

    queuedListeners.push(function(newPercent){
        // read value
        var left = newPercent * container.offsetWidth;
        // write value in a queues
        queues.domUIQueue.enqueue(Reflect.set, Reflect,[slider.style, "left",left+"px"],{});
    });

    var left = 0.5 * container.offsetWidth;
    slider.style.left = left+"px";
    return container;
}
var thrashing = document.querySelector("#thrashing"),
    queued = document.querySelector("#queued");

for(var i = 0; i < 1000; i++) {
    thrashing.appendChild( thrashingWidget("80%") );
    thrashing.appendChild( queuedWidget("100%") );
}

queues.enqueueByQueue({
    notify: queuedListeners
},null,[0.5]);


queues.enqueueByQueue({
    notify: thrashingListeners
},null,[0.5])

document.querySelector("#update-thrash").onclick = function(){
    queues.enqueueByQueue({
        notify: thrashingListeners
    },null,[Math.random()])
}

document.querySelector("#update-queued").onclick = function(){
    queues.enqueueByQueue({
        notify: queuedListeners
    },null,[Math.random()])
}

</script>
